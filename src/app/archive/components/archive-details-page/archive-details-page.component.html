<div class="archive-details-page standard-content-container-width">
  <section class="top">
    <app-case-details *ngIf="case" [case]="case">
      <app-breadcrumb class="breadcrumb" [links]="breadcrumbLinks"></app-breadcrumb>
    </app-case-details>
  </section>

  <app-question-carousel [questions]="archiveQuestions">
    <div class="flag question-container-action"><i class="fas fa-flag"></i>Fall melden</div>
  </app-question-carousel>

  <section class="bottom">
    <div class="facts">
      <app-case-facts [case]="case"></app-case-facts>
    </div>

    <div class="overview">
      <h2 class="overview__title mono-font">Fallabschlussbericht</h2>
      <app-case-result-card [case]="case"></app-case-result-card>

      <div class="overview__archive-detail">
        <div *ngFor="let answer of answers" class="show-archive-detail-description">
          <div
            *ngIf="percentageResponses.hasOwnProperty(answer) && percentageResponses[answer] > 0; then show_number; else other_content"
          ></div>

          <ng-template #show_number>
            <p class="show-archive-detail-mark">
              {{ this.percentageResponses[answer] }}%
              <sub class="sub-description"
                >Der Fragen wurden mit "<i>{{ answer }}</i
                >" beantwortet.</sub
              >
            </p>
          </ng-template>
          <ng-template #other_content>
            <div>
              Keine Frage wurde mit "<i>{{ answer }}</i
              >" beantwortet.
            </div>
          </ng-template>
        </div>
        <!-- "Kriterium nicht anwendbar" -->

        <!-- <div class="show-archive-detail-description">Die Kriterien waren auf alle Fragen anwendbar.</div>
        20% Der Fragen hatten Kriterien die nicht anwendbar waren -->
      </div>
      <div class="archive-case-date-info">
        <div class="">Der Fall war 27 Tage aktiv.</div>
        <span><i class="far fa-calendar-check"></i>&nbsp;02.01.0001</span>
      </div>
      <div class="tag-icon-container">
        <div class="tag-icon-container-title">Folgendes trifft auf den Fall zu</div>
        <div class="tag-icon-container-content">
          <app-tag-icon *ngFor="let tag of tags" [tag]="tag"></app-tag-icon>
        </div>
      </div>
      <div class="detectives-container">
        <div class="detectives-container-title">Ermittelnde Detektive</div>
        <div class="detectives-container-body">
          <div class="detective-content" *ngFor="let detective of detectives; let index = index">
            <div class="medal-container {{ index === 0 ? 'font-supernova' : index === 1 ? 'font-purple' : '' }}">
              <i *ngIf="index < 2" class="fas fa-medal"></i>
            </div>
            <div class="profile-container">
              <div class="avatar font-bold {{ detective.color }}">{{ detective.user === 'Detective' ? '?' : detective.user[0] }}</div>
              <div class="profile-info">
                <div class="name {{ detective.user === 'Detective' ? 'font-italic' : 'font-bold' }}">{{ detective.user }}</div>
                <!-- <div class="job">{{detective.job}}</div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="comments-container">
        <div class="comments-container-title font-bold">Fallbewertungskommentare</div>
        <div *ngIf="case && case.hasOwnProperty('reviewComments') && case.reviewComments.length > 0" class="comments-container-body">
          <app-comment-list [comments]="case.reviewComments"></app-comment-list>
        </div>

        <div class="show-case">
          <span class="font-bold title">Fallbearbeitung</span>&nbsp;
          <span class="explain" (click)="changeCaseCollapse()">{{ caseCollapse ? 'ausblenden' : 'einblenden' }}</span
          >&nbsp;
          <i *ngIf="!caseCollapse" class="fas fa-chevron-right"></i>
          <i *ngIf="caseCollapse" class="fas fa-chevron-down"></i>
        </div>
        <div *ngIf="caseCollapse" class="question-section">
          <div *ngFor="let question of showQuestions; let i = index">
            <!-- todo: set [contributors].. but is the data there? -->
            <app-question
              [question]="question"
              [contributors]="[detectives[0]]"
              [percentageVoted]="33"
              [displayOnly]="true"
              [index]="i"
              [questions]="questions"
            ></app-question>

            <!-- <app-question [question]="question" [percentageVoted]="33" [displayOnly]="true" [index]="i" [questions]="questions"></app-question> -->
          </div>
        </div>
      </div>
      <div *ngIf="authenticated" class="comments-container">
        <div class="comments-container-title">
          <span class="font-bold">Communitydiskussion</span>&nbsp;
          <span class="explain" (click)="changeCommunityCollapse()">{{ communityCollapse ? 'ausblenden' : 'einblenden' }}</span
          >&nbsp;
          <i *ngIf="!communityCollapse" class="fas fa-chevron-right"></i>
          <i *ngIf="communityCollapse" class="fas fa-chevron-down"></i>
        </div>
        <div *ngIf="case && case.hasOwnProperty('comments')" class="comments-container-body">
          <app-comment-list [comments]="case.comments"></app-comment-list>
        </div>
      </div>
      <div *ngIf="authenticated" class="discussions-button-container">
        <button>Mehr Kommentare laden</button>
      </div>

      <app-comment-input [user]="user" (commentSubmitted)="onPostComment($event)" [authenticated]="authenticated"></app-comment-input>
    </div>
  </section>
</div>
